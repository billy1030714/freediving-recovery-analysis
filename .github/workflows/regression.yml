name: MLOps Pipeline Validation
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  validate-pipeline:
    runs-on: ubuntu-latest
    env:
      CI: "true"
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Set up Python and Poetry
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: Install Poetry
        run: pipx install poetry
        
      - name: Install Dependencies
        run: poetry install --no-root
        
      - name: Validate DVC Pipeline Structure
        run: poetry run dvc dag
        
      - name: Test Dual-Track Core Validation
        run: |
          export TASK_TYPE="short_term"
          export TARGETS="ERS"
          PYTHONPATH=${{ github.workspace }} poetry run python hrr_analysis/04_models.py
        env:
          CI: "true"