# README.md

# Personalized Freediving Recovery Analysis & ML Feasibility Study

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![CI/CD](https://img.shields.io/badge/CI%2FCD-GitHub_Actions-2088FF.svg)](https://github.com/billy1030714/freediving-recovery-analysis/actions)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

## ğŸ¯ Research Objective

This project establishes a **rigorous validation framework** for consumer wearable health monitoring, using freediving recovery as a physiological model. The core contribution is a **dual-track validation methodology** that scientifically delineates the capabilities and limitations of consumer-grade devices in personalized health assessment.

-------------------------------------------------------------------------------------------

## ğŸ”¬ Key Innovation: Dual-Track Validation

This project's core innovation is a dual-track methodology to systematically separate algorithm validation from scientific predictability testing.

| Track | Purpose | Features Used | Best RÂ² Score (ERS) | Interpretation |
|-------|---------|---------------|:-------------------:|----------------|
| **A** | **Algorithm Validation** | Pre-dive features + **Recovery-phase data** | **0.9175** | âœ… Effective descriptive tool |
| **B** | **Prediction Boundary** | **Only** Pre-dive features (leak-free) | **-0.1015** | âœ… Confirms prediction limits |

-------------------------------------------------------------------------------------------

## ğŸš€ Quick Start (MLOps Workflow)

This project is managed by a full MLOps pipeline ensuring 100% reproducibility.

### 1. Setup Environment

First, ensure you have [Poetry](https://python-poetry.org/docs/#installation) installed for dependency management.

```bash
# Clone the repository and navigate into it
git clone https://github.com/billy1030714/freediving-recovery-analysis.git
cd freediving-recovery-analysis

# Install all dependencies using Poetry
# This creates a virtual environment with exact package versions from poetry.lock
poetry install
````

### 2. Retrieve Data

The version-controlled data is stored remotely. Use DVC to pull it to your local machine.

```bash
# Pull the data from the configured DVC remote (GCS)
poetry run dvc pull
```

### 3. Reproduce the Pipeline

Run the entire MLOps pipeline from data cleaning to model training with a single command.

```bash
# DVC will check dependencies and run all necessary stages defined in dvc.yaml
poetry run dvc repro
```

This command executes the clean, featurize, and train stages in the correct order, generating all artifacts in the `converted/`, `features/`, and `models/` directories.

-------------------------------------------------------------------------------------------

## ğŸ“ˆ Results Summary

The following results were generated by running the full pipeline on a dataset of 121 measurements (split into training and validation sets).

### Statistical Analysis

The analysis includes comprehensive statistical validation using correlation analysis and p-value testing to ensure the robustness of findings. Key statistical metrics include:

* Pearson correlation coefficients with significance testing
* P-value calculations for statistical significance validation
* Physiological relationship verification between baseline heart rate and recovery metrics

For detailed statistical analysis of mean RR interval predictions, see `analysis/analyze_mean_rr.py` which provides in-depth correlation analysis and p-value testing.

### ğŸ” Augmentation Validation (Optional)

We provide a dedicated script to validate the effectiveness of data augmentation on ERS prediction.

To run the validation, execute the following command:

```bash
python scripts/validate_augmentation.py
```

-------------------------------------------------------------------------------------------

### Track A: Algorithm Validation (short\_term mode)

This track validates the Early Recovery Score (ERS) as a descriptive tool. The high RÂ² score confirms that the chosen components effectively describe the recovery state.

| Model          |  RÂ² Score  | MAE    | RMSE   |
| -------------- | :--------: | ------ | ------ |
| XGBoost (Best) | **0.9175** | 0.0341 | 0.0472 |
| Random Forest  |   0.8204   | 0.0514 | 0.0697 |
| Ridge          |   0.7226   | 0.0570 | 0.0867 |

-------------------------------------------------------------------------------------------

### Track B: Prediction Boundary (long\_term mode)

This track tests the true predictability of various recovery metrics using only pre-dive features. The results quantitatively define the prediction boundary, showing that while baseline heart rate (mean\_rr\_post) is somewhat predictable, dynamic recovery metrics are not.

| Target Metric  | Best Model    | Best RÂ² Score |
| -------------- | ------------- | ------------- |
| mean\_rr\_post | Ridge         | 0.3114        |
| pnn50\_post    | Ridge         | 0.0371        |
| hrr60          | Random Forest | -0.0380       |
| sdnn\_post     | Ridge         | -0.0732       |
| ERS            | Random Forest | -0.1015       |
| rmssd\_post    | Ridge         | -0.1138       |

-------------------------------------------------------------------------------------------

### ğŸ“Š Learning Curve Analysis

Analysis of the Track A model's learning curve provides a key insight: model performance becomes stable and reliable after approximately 60 training samples, at which point the RÂ² score consistently exceeds 0.88. This suggests a minimum data requirement for achieving personalized, high-fidelity monitoring.

-------------------------------------------------------------------------------------------

## ğŸ¥ Clinical Relevance

### Immediate Applications

* Post-exercise recovery assessment
* Training load optimization
* Safety monitoring in breath-hold sports

### Future Translation Potential

* OSA (Obstructive Sleep Apnea) severity assessment
* COPD exacerbation prediction
* Personalized cardiovascular risk stratification

-------------------------------------------------------------------------------------------

## ğŸ“ Project Structure

The project is organized with a clear separation of concerns, facilitating reproducibility and scalability. Folders marked (gitignored) are generated locally by the DVC pipeline.

```
HRR_project/
â”œâ”€â”€ .github/workflows/      # Automated CI/CD pipelines (GitHub Actions)
â”œâ”€â”€ .dvc/                   # DVC internal cache and config
â”œâ”€â”€ .gitignore              # Specifies intentionally untracked files
â”œâ”€â”€ README.md               # This file
â”œâ”€â”€ pyproject.toml          # Project metadata and dependencies (Poetry)
â”œâ”€â”€ poetry.lock             # Exact versions of all dependencies
â”œâ”€â”€ dvc.yaml                # Defines the MLOps pipeline stages
â”œâ”€â”€ params.yaml             # Centralized parameters for the pipeline
â”œâ”€â”€ paths.py                # Centralized path configuration
â”‚
â”œâ”€â”€ apple_health_export/    # (gitignored) Raw Apple Health data
â”‚   â””â”€â”€ export.xml.dvc      # DVC pointer to raw data
â”‚
â”œâ”€â”€ converted/              # (gitignored) Intermediate data from cleaning
â”œâ”€â”€ features/               # (gitignored) Engineered features for ML
â”œâ”€â”€ models/                 # (gitignored) Trained models and metadata
â”œâ”€â”€ mlruns/                 # (gitignored) MLflow experiment tracking data
â”œâ”€â”€ ... (other directories)
â”‚
â””â”€â”€ utils/                  # Utility functions (e.g., data_loader)
```

-------------------------------------------------------------------------------------------

## ğŸ”§ Technical Stack

**ML Framework:** XGBoost, Scikit-learn

**MLOps & Automation:**

* Poetry: Dependency Management & Reproducible Environments
* DVC: Data & Pipeline Version Control
* MLflow: Experiment Tracking & Logging
* GitHub Actions: Continuous Integration & Automated Pipeline Execution
* Google Cloud Storage: Remote DVC Storage

**Explainability:** SHAP, LIME
**Data Processing:** Pandas, NumPy
**Statistical Analysis:** SciPy, Pearson correlation, P-value testing
**Validation:** Pytest, Custom MLOps Scripts

-------------------------------------------------------------------------------------------

## ğŸ‘¤ Author

Yi-Chuan Su (è˜‡ç¿ŠéŠ“)

ğŸ“ B.S. Nursing, China Medical University (2024)
ğŸ¥ Registered Nurse (Taiwan)
ğŸŠ AIDA4 & Molchanovs W3 Freediving Instructor Assistant

ğŸ“§ Contact: Via GitHub Issues

-------------------------------------------------------------------------------------------

## ğŸ“„ License

This project is licensed under the MIT License. See the LICENSE file for details.

-------------------------------------------------------------------------------------------

## ğŸ™ Acknowledgments

* Freediving community - Data collection support
* Open source contributors - Tools and libraries